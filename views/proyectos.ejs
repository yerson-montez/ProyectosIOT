<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Proyectos IoT - Innovación y Tecnología</title>
  <meta name="description" content="Descubre los mejores proyectos de Internet of Things (IoT) desarrollados por estudiantes y profesionales">
  <meta name="keywords" content="IoT, Internet de las Cosas, proyectos, tecnología, innovación">
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="/img/favicon.png">
  
  <!-- CSS -->
  <link rel="stylesheet" href="/css/styles.css">
  
  <!-- Font Awesome para iconos -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <!-- HEADER CON NAVEGACIÓN MEJORADA -->
  <header class="header">
    <div class="navbar">
      <div class="logo-container">
        <img src="/img/logo.png" alt="Logo IoT Projects" class="logo" />
        <span class="logo-text">IoT Projects</span>
      </div>
      
      <nav class="nav-links" id="navLinks">
        <a href="/" class="nav-link active">
          <i class="fas fa-home"></i>
          <span>Inicio</span>
        </a>
        <a href="/proyectos" class="nav-link">
          <i class="fas fa-folder-open"></i>
          <span>Proyectos</span>
        </a>
        <a href="/registrar" class="nav-link">
          <i class="fas fa-user-plus"></i>
          <span>Registrarse</span>
        </a>
        <a href="/login" class="nav-link">
          <i class="fas fa-sign-in-alt"></i>
          <span>Iniciar Sesión</span>
        </a>
        <a href="/proyectos/subir" class="nav-link btn-primary">
          <i class="fas fa-plus"></i>
          <span>Subir Proyecto</span>
        </a>
      </nav>
      
      <!-- Botón menú móvil -->
      <button class="mobile-menu-btn" id="mobileMenuBtn">
        <i class="fas fa-bars"></i>
      </button>
    </div>
  </header>

  <!-- HERO SECTION -->
  <section class="hero">
    <div class="hero-content">
      <h1 class="hero-title">
        Proyectos de <span class="gradient-text">IoT</span>
      </h1>
      <p class="hero-subtitle">
        Descubre proyectos innovadores del Internet de las Cosas desarrollados por estudiantes y profesionales
      </p>
      <div class="hero-stats">
        <div class="stat">
          <i class="fas fa-microchip"></i>
          <span class="stat-number" id="totalProyectos"><%= proyectos ? proyectos.length : 0 %></span>
          <span class="stat-label">Proyectos</span>
        </div>
        <div class="stat">
          <i class="fas fa-users"></i>
          <span class="stat-number">150+</span>
          <span class="stat-label">Desarrolladores</span>
        </div>
        <div class="stat">
          <i class="fas fa-award"></i>
          <span class="stat-number">25</span>
          <span class="stat-label">Categorías</span>
        </div>
      </div>
    </div>
    <div class="hero-animation">
      <div class="floating-card">
        <i class="fas fa-wifi"></i>
      </div>
      <div class="floating-card">
        <i class="fas fa-mobile-alt"></i>
      </div>
      <div class="floating-card">
        <i class="fas fa-cloud"></i>
      </div>
    </div>
  </section>

  <!-- FILTROS Y BÚSQUEDA -->
  <section class="filters-section">
    <div class="container">
      <div class="filters-container">
        <div class="search-bar">
          <i class="fas fa-search"></i>
          <input type="text" id="searchInput" placeholder="Buscar proyectos...">
        </div>
        
        <div class="filter-options">
          <button class="filter-btn active" data-filter="all">
            <i class="fas fa-th"></i>
            Todos
          </button>
          <button class="filter-btn" data-filter="arduino">
            <i class="fab fa-arduino"></i>
            Arduino
          </button>
          <button class="filter-btn" data-filter="raspberry">
            <i class="fab fa-raspberry-pi"></i>
            Raspberry Pi
          </button>
          <button class="filter-btn" data-filter="esp32">
            <i class="fas fa-microchip"></i>
            ESP32
          </button>
          <button class="filter-btn" data-filter="sensores">
            <i class="fas fa-thermometer-half"></i>
            Sensores
          </button>
        </div>
        
        <div class="sort-options">
          <select id="sortSelect">
            <option value="newest">Más recientes</option>
            <option value="oldest">Más antiguos</option>
            <option value="name">Por nombre</option>
            <option value="popular">Más populares</option>
          </select>
        </div>
      </div>
    </div>
  </section>

  <!-- CONTENIDO PRINCIPAL -->
  <main class="main-content">
    <div class="container">
      <% if (proyectos && proyectos.length > 0) { %>
        <!-- Loading skeleton -->
        <div class="loading-skeleton" id="loadingSkeleton" style="display: none;">
          <% for(let i = 0; i < 6; i++) { %>
            <div class="skeleton-card">
              <div class="skeleton-image"></div>
              <div class="skeleton-content">
                <div class="skeleton-title"></div>
                <div class="skeleton-text"></div>
                <div class="skeleton-text"></div>
                <div class="skeleton-button"></div>
              </div>
            </div>
          <% } %>
        </div>

        <!-- Grid de proyectos -->
        <div class="projects-grid" id="projectsGrid">
          <% proyectos.forEach((p, index) => { %>
            <article class="project-card" data-category="<%= p.categoria || 'general' %>" data-name="<%= p.nombre.toLowerCase() %>">
              <div class="card-image-container">
                <img class="card-img" 
                     src="/uploads/imagenes/<%= p.imagen %>" 
                     alt="<%= p.nombre %>" 
                     onerror="this.src='/img/default.png'"
                     loading="lazy" />
                <div class="card-overlay">
                  <div class="card-actions">
                    <button class="action-btn like-btn" data-id="<%= p.id %>">
                      <i class="fas fa-heart"></i>
                    </button>
                    <button class="action-btn share-btn" data-id="<%= p.id %>">
                      <i class="fas fa-share-alt"></i>
                    </button>
                    <button class="action-btn bookmark-btn" data-id="<%= p.id %>">
                      <i class="fas fa-bookmark"></i>
                    </button>
                  </div>
                </div>
                <div class="card-badge">
                  <i class="fas fa-microchip"></i>
                  <%= p.categoria || 'IoT' %>
                </div>
              </div>
              
              <div class="card-body">
                <div class="card-header">
                  <h3 class="card-title"><%= p.nombre %></h3>
                  <div class="card-rating">
                    <% for(let i = 0; i < 5; i++) { %>
                      <i class="fas fa-star <%= i < (p.rating || 4) ? 'active' : '' %>"></i>
                    <% } %>
                  </div>
                </div>
                
                <p class="card-description">
                  <%= p.descripcion ? p.descripcion.substring(0, 100) + '...' : 'Proyecto innovador de IoT' %>
                </p>
                
                <div class="card-meta">
                  <div class="meta-item">
                    <i class="fas fa-users"></i>
                    <span><%= p.integrantes %></span>
                  </div>
                  <div class="meta-item">
                    <i class="fas fa-calendar"></i>
                    <span><%= p.fecha ? new Date(p.fecha).toLocaleDateString('es-ES') : 'Reciente' %></span>
                  </div>
                </div>
                
                <div class="card-tags">
                  <% if (p.tecnologias) { %>
                    <% p.tecnologias.split(',').slice(0, 3).forEach(tech => { %>
                      <span class="tag"><%= tech.trim() %></span>
                    <% }) %>
                  <% } else { %>
                    <span class="tag">IoT</span>
                    <span class="tag">Sensores</span>
                  <% } %>
                </div>
                
                <div class="card-footer">
                  <div class="card-stats">
                    <span class="stat-item">
                      <i class="fas fa-heart"></i>
                      <%= p.likes || Math.floor(Math.random() * 50) + 5 %>
                    </span>
                    <span class="stat-item">
                      <i class="fas fa-eye"></i>
                      <%= p.views || Math.floor(Math.random() * 200) + 50 %>
                    </span>
                  </div>
                  
                  <a href="/proyectos/<%= p.id %>" class="btn btn-primary">
                    <i class="fas fa-arrow-right"></i>
                    Ver Proyecto
                  </a>
                </div>
              </div>
            </article>
          <% }) %>
        </div>

        <!-- Paginación -->
        <div class="pagination-container">
          <div class="pagination">
            <button class="pagination-btn" id="prevPage" disabled>
              <i class="fas fa-chevron-left"></i>
              Anterior
            </button>
            <div class="pagination-info">
              Página <span id="currentPage">1</span> de <span id="totalPages">1</span>
            </div>
            <button class="pagination-btn" id="nextPage">
              Siguiente
              <i class="fas fa-chevron-right"></i>
            </button>
          </div>
        </div>
      <% } else { %>
        <!-- Estado vacío -->
        <div class="empty-state">
          <div class="empty-icon">
            <i class="fas fa-folder-open"></i>
          </div>
          <h2>No hay proyectos disponibles</h2>
          <p>¡Sé el primero en compartir tu proyecto de IoT!</p>
          <a href="/proyectos/subir" class="btn btn-primary">
            <i class="fas fa-plus"></i>
            Subir Primer Proyecto
          </a>
        </div>
      <% } %>
    </div>
  </main>

  <!-- FOOTER -->
  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-section">
          <h4>IoT Projects</h4>
          <p>Plataforma para compartir y descubrir proyectos innovadores del Internet de las Cosas.</p>
          <div class="social-links">
            <a href="#" aria-label="Facebook"><i class="fab fa-facebook"></i></a>
            <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
            <a href="#" aria-label="GitHub"><i class="fab fa-github"></i></a>
            <a href="#" aria-label="LinkedIn"><i class="fab fa-linkedin"></i></a>
          </div>
        </div>
        
        <div class="footer-section">
          <h4>Enlaces Rápidos</h4>
          <ul>
            <li><a href="/">Inicio</a></li>
            <li><a href="/proyectos">Proyectos</a></li>
            <li><a href="/sobre-nosotros">Sobre Nosotros</a></li>
            <li><a href="/contacto">Contacto</a></li>
          </ul>
        </div>
        
        <div class="footer-section">
          <h4>Categorías</h4>
          <ul>
            <li><a href="/categoria/arduino">Arduino</a></li>
            <li><a href="/categoria/raspberry">Raspberry Pi</a></li>
            <li><a href="/categoria/esp32">ESP32</a></li>
            <li><a href="/categoria/sensores">Sensores</a></li>
          </ul>
        </div>
        
        <div class="footer-section">
          <h4>Recursos</h4>
          <ul>
            <li><a href="/documentacion">Documentación</a></li>
            <li><a href="/tutoriales">Tutoriales</a></li>
            <li><a href="/api">API</a></li>
            <li><a href="/ayuda">Ayuda</a></li>
          </ul>
        </div>
      </div>
      
      <div class="footer-bottom">
        <p>&copy; 2025 IoT Projects. Todos los derechos reservados.</p>
        <div class="footer-links">
          <a href="/privacidad">Política de Privacidad</a>
          <a href="/terminos">Términos de Uso</a>
        </div>
      </div>
    </div>
  </footer>

  <!-- MODALES -->
  <!-- Modal de compartir -->
  <div class="modal" id="shareModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Compartir Proyecto</h3>
        <button class="modal-close" onclick="closeModal('shareModal')">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <div class="share-options">
          <button class="share-btn" data-platform="facebook">
            <i class="fab fa-facebook"></i>
            Facebook
          </button>
          <button class="share-btn" data-platform="twitter">
            <i class="fab fa-twitter"></i>
            Twitter
          </button>
          <button class="share-btn" data-platform="whatsapp">
            <i class="fab fa-whatsapp"></i>
            WhatsApp
          </button>
          <button class="share-btn" data-platform="copy">
            <i class="fas fa-copy"></i>
            Copiar enlace
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Botón scroll to top -->
  <button class="scroll-top" id="scrollTop">
    <i class="fas fa-chevron-up"></i>
  </button>

  <!-- Notificaciones toast -->
  <div class="toast-container" id="toastContainer"></div>

  <!-- Scripts -->
  <script>
    // Variables globales
    let currentPage = 1;
    const itemsPerPage = 9;
    let filteredProjects = [];
    let allProjects = [];

    // Inicialización
    document.addEventListener('DOMContentLoaded', function() {
      initializeApp();
    });

    function initializeApp() {
      // Obtener todos los proyectos
      allProjects = Array.from(document.querySelectorAll('.project-card'));
      filteredProjects = [...allProjects];
      
      // Inicializar funcionalidades
      initializeSearch();
      initializeFilters();
      initializePagination();
      initializeMobileMenu();
      initializeScrollTop();
      initializeCardInteractions();
      initializeAnimations();
    }

    // Búsqueda
    function initializeSearch() {
      const searchInput = document.getElementById('searchInput');
      
      searchInput.addEventListener('input', debounce(function(e) {
        const searchTerm = e.target.value.toLowerCase();
        filterProjects(searchTerm);
      }, 300));
    }

    // Filtros
    function initializeFilters() {
      const filterButtons = document.querySelectorAll('.filter-btn');
      const sortSelect = document.getElementById('sortSelect');
      
      filterButtons.forEach(btn => {
        btn.addEventListener('click', function() {
          // Actualizar botón activo
          filterButtons.forEach(b => b.classList.remove('active'));
          this.classList.add('active');
          
          // Aplicar filtro
          const filter = this.dataset.filter;
          applyFilter(filter);
        });
      });
      
      sortSelect.addEventListener('change', function() {
        sortProjects(this.value);
      });
    }

    // Paginación
    function initializePagination() {
      const prevBtn = document.getElementById('prevPage');
      const nextBtn = document.getElementById('nextPage');
      
      prevBtn.addEventListener('click', () => changePage(currentPage - 1));
      nextBtn.addEventListener('click', () => changePage(currentPage + 1));
      
      updatePagination();
    }

    // Menú móvil
    function initializeMobileMenu() {
      const mobileMenuBtn = document.getElementById('mobileMenuBtn');
      const navLinks = document.getElementById('navLinks');
      
      mobileMenuBtn.addEventListener('click', function() {
        navLinks.classList.toggle('active');
        const icon = this.querySelector('i');
        icon.classList.toggle('fa-bars');
        icon.classList.toggle('fa-times');
      });
    }

    // Scroll to top
    function initializeScrollTop() {
      const scrollTopBtn = document.getElementById('scrollTop');
      
      window.addEventListener('scroll', function() {
        if (window.pageYOffset > 300) {
          scrollTopBtn.classList.add('visible');
        } else {
          scrollTopBtn.classList.remove('visible');
        }
      });
      
      scrollTopBtn.addEventListener('click', function() {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });
    }

    // Interacciones de tarjetas
    function initializeCardInteractions() {
      // Botones de like
      document.querySelectorAll('.like-btn').forEach(btn => {
        btn.addEventListener('click', function(e) {
          e.preventDefault();
          this.classList.toggle('active');
          showToast(this.classList.contains('active') ? 'Proyecto agregado a favoritos' : 'Proyecto removido de favoritos');
        });
      });
      
      // Botones de compartir
      document.querySelectorAll('.share-btn').forEach(btn => {
        btn.addEventListener('click', function(e) {
          e.preventDefault();
          openModal('shareModal');
        });
      });
      
      // Botones de bookmark
      document.querySelectorAll('.bookmark-btn').forEach(btn => {
        btn.addEventListener('click', function(e) {
          e.preventDefault();
          this.classList.toggle('active');
          showToast(this.classList.contains('active') ? 'Proyecto guardado' : 'Proyecto removido de guardados');
        });
      });
    }

    // Animaciones
    function initializeAnimations() {
      // Animación de entrada para las tarjetas
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.style.animationDelay = `${Math.random() * 0.5}s`;
            entry.target.classList.add('animate-in');
          }
        });
      });
      
      document.querySelectorAll('.project-card').forEach(card => {
        observer.observe(card);
      });
    }

    // Funciones auxiliares
    function debounce(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(timeout);
          func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    }

    function filterProjects(searchTerm) {
      filteredProjects = allProjects.filter(project => {
        const name = project.dataset.name;
        return name.includes(searchTerm);
      });
      
      currentPage = 1;
      updateDisplay();
    }

    function applyFilter(filter) {
      if (filter === 'all') {
        filteredProjects = [...allProjects];
      } else {
        filteredProjects = allProjects.filter(project => {
          return project.dataset.category === filter;
        });
      }
      
      currentPage = 1;
      updateDisplay();
    }

    function sortProjects(sortBy) {
      switch(sortBy) {
        case 'name':
          filteredProjects.sort((a, b) => a.dataset.name.localeCompare(b.dataset.name));
          break;
        case 'newest':
          // Implementar lógica de ordenación por fecha
          break;
        case 'oldest':
          // Implementar lógica de ordenación por fecha
          break;
        case 'popular':
          // Implementar lógica de ordenación por popularidad
          break;
      }
      
      updateDisplay();
    }

    function changePage(newPage) {
      const totalPages = Math.ceil(filteredProjects.length / itemsPerPage);
      
      if (newPage >= 1 && newPage <= totalPages) {
        currentPage = newPage;
        updateDisplay();
      }
    }

    function updateDisplay() {
      const startIndex = (currentPage - 1) * itemsPerPage;
      const endIndex = startIndex + itemsPerPage;
      
      // Ocultar todas las tarjetas
      allProjects.forEach(project => {
        project.style.display = 'none';
      });
      
      // Mostrar solo las tarjetas filtradas y paginadas
      const projectsToShow = filteredProjects.slice(startIndex, endIndex);
      projectsToShow.forEach(project => {
        project.style.display = 'block';
      });
      
      updatePagination();
    }

    function updatePagination() {
      const totalPages = Math.ceil(filteredProjects.length / itemsPerPage);
      
      document.getElementById('currentPage').textContent = currentPage;
      document.getElementById('totalPages').textContent = totalPages;
      
      document.getElementById('prevPage').disabled = currentPage === 1;
      document.getElementById('nextPage').disabled = currentPage === totalPages;
    }

    function openModal(modalId) {
      document.getElementById(modalId).classList.add('active');
    }

    function closeModal(modalId) {
      document.getElementById(modalId).classList.remove('active');
    }

    function showToast(message) {
      const toast = document.createElement('div');
      toast.className = 'toast';
      toast.textContent = message;
      
      document.getElementById('toastContainer').appendChild(toast);
      
      setTimeout(() => {
        toast.classList.add('show');
      }, 100);
      
      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => {
          toast.remove();
        }, 300);
      }, 3000);
    }

    // Cerrar modal al hacer clic fuera
    window.addEventListener('click', function(e) {
      if (e.target.classList.contains('modal')) {
        closeModal(e.target.id);
      }
    });
  </script>
</body>
</html>